# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: Tatum - build and generate

on:
  push:
    branches: [ "develop" ]
  pull_request:
    branches: [ "develop" ]

jobs:
  Generate_Core:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
    - name: Build with Maven
      run: mvn clean package -f pom.xml -DskipTests
    - name: Generate Tatum.CSharp.Core
      run: java -jar ./modules/openapi-generator-cli/target/openapi-generator-cli.jar generate -i ./tatum/openapi_trim_trans.json -g csharp-netcore -o . --library=httpclient --global-property generateAliasAsModel=false,modelTests=false,apiTests=false,apiDocs=false,modelDocs=false --additional-properties=packageName=Tatum.CSharp.Core,oneOfMappingFilePath=./tatum/oneOfMapping.json,sourceFolder=""
  
  Build_Version:
    uses: ./.github/workflows/calculateBuildVersion.yml

  Core_Pack_RC:
    uses: ./.github/workflows/prepareBuildPackage.yml
    with:
      name: Core
      version: ${{ needs.Build_Version.outputs.version }}
    secrets: inherit
    needs: Build_Version
